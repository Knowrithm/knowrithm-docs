services:
  mintlify:
    image: node:18
    container_name: mintlify
    working_dir: /docs
    ports:
      - "3030:3030"
    volumes:
      - .:/docs
    command: >
      sh -c "npm install -g mintlify && mintlify dev --noTelemetry --port 3030 --host 0.0.0.0"
    networks:
      - knowrithm_network  # Changed from traefik-backend
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mintlify.rule=Host(`docs.knowrithm.org`)"
      - "traefik.http.routers.mintlify.entrypoints=websecure"
      - "traefik.http.routers.mintlify.tls=true"
      - "traefik.http.routers.mintlify.tls.certresolver=cloudflare"
      - "traefik.http.services.mintlify.loadbalancer.server.port=3030"
      - "traefik.docker.network=knowrithm_network"  # Updated network
      # HTTP to HTTPS redirect
      - "traefik.http.routers.mintlify-insecure.rule=Host(`docs.knowrithm.org`)"
      - "traefik.http.routers.mintlify-insecure.entrypoints=web"
      - "traefik.http.routers.mintlify-insecure.middlewares=redirect-to-https"
      - "traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https"
networks:
  knowrithm_network:  # Changed from traefik-backend
    external: true
